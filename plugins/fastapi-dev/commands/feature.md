---
name: feature
description: 完整的 FastAPI 功能开发流程：设计 → 实现 → 审查
---

# FastAPI 完整功能开发

完整的功能开发流程，支持大功能拆分为多个子任务逐个处理。

## 流程概述

### 阶段 1：设计
调用 `fastapi-designer` agent 产出设计文档，包含任务清单。

### 阶段 2：确认
展示设计文档给用户，确认后进入实现阶段。

### 阶段 3：实现与审查（循环）
```
循环执行直到所有任务完成：

1. 读取任务目录下的 spec.md 任务清单
2. 找到第一个「待开始」或「待审核」的任务
3. 如果是「待开始」：调用 fastapi-developer 实现
4. 如果是「待审核」：调用 fastapi-reviewer 审查
   - 通过 → 标记为「已完成」
   - 不通过 → developer 修复 → 重新审查
5. 检查是否还有未完成任务
   - 有 → 继续循环
   - 无 → 流程结束
```

### 任务状态流转
```
待开始 → 进行中 → 待审核 → 已完成
            ↑         │
            └─────────┘
           (审核不通过)
```

### 任务目录结构
```
.agent/
├── tips.md              # 经验文档（全局共享）
└── tasks/
    └── {feature}-{seq}/
        ├── spec.md      # 设计文档 + 任务状态
        └── review.md    # 审查记录（累积追加）
```

---

用户输入：

$ARGUMENTS

---

## 执行指南

### 步骤 1：解析输入

判断 `$ARGUMENTS` 的类型：

**情况 A：输入为空**
- 询问用户要开发什么功能

**情况 B：输入是已存在的任务 ID**
- 检查 `.agent/tasks/{输入}/` 目录是否存在
- 如果存在，说明是继续执行已有任务

**情况 C：输入是功能描述**
- 不是已存在的任务 ID，视为新功能描述

### 步骤 2：根据类型执行

#### 情况 A/C：新任务

1. 询问用户功能名称（用于生成 task-id，如 `user-auth`）
2. 扫描 `.agent/tasks/` 目录，生成 task-id：
   - 查找匹配 `{功能名}-*` 的目录
   - 取最大序号 + 1（无则为 001）
   - 格式：`{功能名}-{seq}`，如 `user-auth-001`
3. 创建任务目录：`.agent/tasks/{task-id}/`
4. 调用 `fastapi-designer` agent，传递指令：
   ```
   ## 文件
   - 设计文档: .agent/tasks/{task-id}/spec.md
   - 经验文档: .agent/tips.md

   ## 任务
   功能描述：{用户的功能描述}

   请完成设计流程，将设计文档写入指定文件。
   ```
5. 用户确认设计后，进入实现循环

#### 情况 B：继续已有任务

1. 读取任务状态：`.agent/tasks/{task-id}/spec.md`
2. 进入实现循环

### 步骤 3：实现与审查循环

```
循环执行：
1. 读取 .agent/tasks/{task-id}/spec.md 中的任务清单
2. 找到第一个「待开始」或「待审核」的子任务
3. 根据状态调用对应 agent：

   如果是「待开始」：
   调用 fastapi-developer，传递指令：
   ---
   ## 文件
   - 设计文档: .agent/tasks/{task-id}/spec.md
   - 经验文档: .agent/tips.md

   ## 任务
   实现设计文档中第一个「待开始」的子任务。
   完成后更新状态为「待审核」。
   ---

   如果是「待审核」：
   调用 fastapi-reviewer，传递指令：
   ---
   ## 文件
   - 设计文档: .agent/tasks/{task-id}/spec.md
   - 审查记录: .agent/tasks/{task-id}/review.md
   - 经验文档: .agent/tips.md

   ## 任务
   审查设计文档中「待审核」状态的子任务。
   - 审查结果追加到审查记录文件
   - 通过则更新状态为「已完成」，不通过则保持「待审核」
   ---

4. 检查是否还有未完成的子任务
   - 有 → 继续循环
   - 无 → 任务完成，结束流程
```

每个 agent 按照其定义的流程执行。
